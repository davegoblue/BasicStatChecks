<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

<title>Overview and Synopsis</title>

<script type="text/javascript">
window.onload = function() {
  var imgs = document.getElementsByTagName('img'), i, img;
  for (i = 0; i < imgs.length; i++) {
    img = imgs[i];
    // center an image if it is the only element of its parent
    if (img.parentElement.childElementCount === 1)
      img.parentElement.style.textAlign = 'center';
  }
};
</script>

<!-- Styles for R syntax highlighter -->
<style type="text/css">
   pre .operator,
   pre .paren {
     color: rgb(104, 118, 135)
   }

   pre .literal {
     color: #990073
   }

   pre .number {
     color: #099;
   }

   pre .comment {
     color: #998;
     font-style: italic
   }

   pre .keyword {
     color: #900;
     font-weight: bold
   }

   pre .identifier {
     color: rgb(0, 0, 0);
   }

   pre .string {
     color: #d14;
   }
</style>

<!-- R syntax highlighter -->
<script type="text/javascript">
var hljs=new function(){function m(p){return p.replace(/&/gm,"&amp;").replace(/</gm,"&lt;")}function f(r,q,p){return RegExp(q,"m"+(r.cI?"i":"")+(p?"g":""))}function b(r){for(var p=0;p<r.childNodes.length;p++){var q=r.childNodes[p];if(q.nodeName=="CODE"){return q}if(!(q.nodeType==3&&q.nodeValue.match(/\s+/))){break}}}function h(t,s){var p="";for(var r=0;r<t.childNodes.length;r++){if(t.childNodes[r].nodeType==3){var q=t.childNodes[r].nodeValue;if(s){q=q.replace(/\n/g,"")}p+=q}else{if(t.childNodes[r].nodeName=="BR"){p+="\n"}else{p+=h(t.childNodes[r])}}}if(/MSIE [678]/.test(navigator.userAgent)){p=p.replace(/\r/g,"\n")}return p}function a(s){var r=s.className.split(/\s+/);r=r.concat(s.parentNode.className.split(/\s+/));for(var q=0;q<r.length;q++){var p=r[q].replace(/^language-/,"");if(e[p]){return p}}}function c(q){var p=[];(function(s,t){for(var r=0;r<s.childNodes.length;r++){if(s.childNodes[r].nodeType==3){t+=s.childNodes[r].nodeValue.length}else{if(s.childNodes[r].nodeName=="BR"){t+=1}else{if(s.childNodes[r].nodeType==1){p.push({event:"start",offset:t,node:s.childNodes[r]});t=arguments.callee(s.childNodes[r],t);p.push({event:"stop",offset:t,node:s.childNodes[r]})}}}}return t})(q,0);return p}function k(y,w,x){var q=0;var z="";var s=[];function u(){if(y.length&&w.length){if(y[0].offset!=w[0].offset){return(y[0].offset<w[0].offset)?y:w}else{return w[0].event=="start"?y:w}}else{return y.length?y:w}}function t(D){var A="<"+D.nodeName.toLowerCase();for(var B=0;B<D.attributes.length;B++){var C=D.attributes[B];A+=" "+C.nodeName.toLowerCase();if(C.value!==undefined&&C.value!==false&&C.value!==null){A+='="'+m(C.value)+'"'}}return A+">"}while(y.length||w.length){var v=u().splice(0,1)[0];z+=m(x.substr(q,v.offset-q));q=v.offset;if(v.event=="start"){z+=t(v.node);s.push(v.node)}else{if(v.event=="stop"){var p,r=s.length;do{r--;p=s[r];z+=("</"+p.nodeName.toLowerCase()+">")}while(p!=v.node);s.splice(r,1);while(r<s.length){z+=t(s[r]);r++}}}}return z+m(x.substr(q))}function j(){function q(x,y,v){if(x.compiled){return}var u;var s=[];if(x.k){x.lR=f(y,x.l||hljs.IR,true);for(var w in x.k){if(!x.k.hasOwnProperty(w)){continue}if(x.k[w] instanceof Object){u=x.k[w]}else{u=x.k;w="keyword"}for(var r in u){if(!u.hasOwnProperty(r)){continue}x.k[r]=[w,u[r]];s.push(r)}}}if(!v){if(x.bWK){x.b="\\b("+s.join("|")+")\\s"}x.bR=f(y,x.b?x.b:"\\B|\\b");if(!x.e&&!x.eW){x.e="\\B|\\b"}if(x.e){x.eR=f(y,x.e)}}if(x.i){x.iR=f(y,x.i)}if(x.r===undefined){x.r=1}if(!x.c){x.c=[]}x.compiled=true;for(var t=0;t<x.c.length;t++){if(x.c[t]=="self"){x.c[t]=x}q(x.c[t],y,false)}if(x.starts){q(x.starts,y,false)}}for(var p in e){if(!e.hasOwnProperty(p)){continue}q(e[p].dM,e[p],true)}}function d(B,C){if(!j.called){j();j.called=true}function q(r,M){for(var L=0;L<M.c.length;L++){if((M.c[L].bR.exec(r)||[null])[0]==r){return M.c[L]}}}function v(L,r){if(D[L].e&&D[L].eR.test(r)){return 1}if(D[L].eW){var M=v(L-1,r);return M?M+1:0}return 0}function w(r,L){return L.i&&L.iR.test(r)}function K(N,O){var M=[];for(var L=0;L<N.c.length;L++){M.push(N.c[L].b)}var r=D.length-1;do{if(D[r].e){M.push(D[r].e)}r--}while(D[r+1].eW);if(N.i){M.push(N.i)}return f(O,M.join("|"),true)}function p(M,L){var N=D[D.length-1];if(!N.t){N.t=K(N,E)}N.t.lastIndex=L;var r=N.t.exec(M);return r?[M.substr(L,r.index-L),r[0],false]:[M.substr(L),"",true]}function z(N,r){var L=E.cI?r[0].toLowerCase():r[0];var M=N.k[L];if(M&&M instanceof Array){return M}return false}function F(L,P){L=m(L);if(!P.k){return L}var r="";var O=0;P.lR.lastIndex=0;var M=P.lR.exec(L);while(M){r+=L.substr(O,M.index-O);var N=z(P,M);if(N){x+=N[1];r+='<span class="'+N[0]+'">'+M[0]+"</span>"}else{r+=M[0]}O=P.lR.lastIndex;M=P.lR.exec(L)}return r+L.substr(O,L.length-O)}function J(L,M){if(M.sL&&e[M.sL]){var r=d(M.sL,L);x+=r.keyword_count;return r.value}else{return F(L,M)}}function I(M,r){var L=M.cN?'<span class="'+M.cN+'">':"";if(M.rB){y+=L;M.buffer=""}else{if(M.eB){y+=m(r)+L;M.buffer=""}else{y+=L;M.buffer=r}}D.push(M);A+=M.r}function G(N,M,Q){var R=D[D.length-1];if(Q){y+=J(R.buffer+N,R);return false}var P=q(M,R);if(P){y+=J(R.buffer+N,R);I(P,M);return P.rB}var L=v(D.length-1,M);if(L){var O=R.cN?"</span>":"";if(R.rE){y+=J(R.buffer+N,R)+O}else{if(R.eE){y+=J(R.buffer+N,R)+O+m(M)}else{y+=J(R.buffer+N+M,R)+O}}while(L>1){O=D[D.length-2].cN?"</span>":"";y+=O;L--;D.length--}var r=D[D.length-1];D.length--;D[D.length-1].buffer="";if(r.starts){I(r.starts,"")}return R.rE}if(w(M,R)){throw"Illegal"}}var E=e[B];var D=[E.dM];var A=0;var x=0;var y="";try{var s,u=0;E.dM.buffer="";do{s=p(C,u);var t=G(s[0],s[1],s[2]);u+=s[0].length;if(!t){u+=s[1].length}}while(!s[2]);if(D.length>1){throw"Illegal"}return{r:A,keyword_count:x,value:y}}catch(H){if(H=="Illegal"){return{r:0,keyword_count:0,value:m(C)}}else{throw H}}}function g(t){var p={keyword_count:0,r:0,value:m(t)};var r=p;for(var q in e){if(!e.hasOwnProperty(q)){continue}var s=d(q,t);s.language=q;if(s.keyword_count+s.r>r.keyword_count+r.r){r=s}if(s.keyword_count+s.r>p.keyword_count+p.r){r=p;p=s}}if(r.language){p.second_best=r}return p}function i(r,q,p){if(q){r=r.replace(/^((<[^>]+>|\t)+)/gm,function(t,w,v,u){return w.replace(/\t/g,q)})}if(p){r=r.replace(/\n/g,"<br>")}return r}function n(t,w,r){var x=h(t,r);var v=a(t);var y,s;if(v){y=d(v,x)}else{return}var q=c(t);if(q.length){s=document.createElement("pre");s.innerHTML=y.value;y.value=k(q,c(s),x)}y.value=i(y.value,w,r);var u=t.className;if(!u.match("(\\s|^)(language-)?"+v+"(\\s|$)")){u=u?(u+" "+v):v}if(/MSIE [678]/.test(navigator.userAgent)&&t.tagName=="CODE"&&t.parentNode.tagName=="PRE"){s=t.parentNode;var p=document.createElement("div");p.innerHTML="<pre><code>"+y.value+"</code></pre>";t=p.firstChild.firstChild;p.firstChild.cN=s.cN;s.parentNode.replaceChild(p.firstChild,s)}else{t.innerHTML=y.value}t.className=u;t.result={language:v,kw:y.keyword_count,re:y.r};if(y.second_best){t.second_best={language:y.second_best.language,kw:y.second_best.keyword_count,re:y.second_best.r}}}function o(){if(o.called){return}o.called=true;var r=document.getElementsByTagName("pre");for(var p=0;p<r.length;p++){var q=b(r[p]);if(q){n(q,hljs.tabReplace)}}}function l(){if(window.addEventListener){window.addEventListener("DOMContentLoaded",o,false);window.addEventListener("load",o,false)}else{if(window.attachEvent){window.attachEvent("onload",o)}else{window.onload=o}}}var e={};this.LANGUAGES=e;this.highlight=d;this.highlightAuto=g;this.fixMarkup=i;this.highlightBlock=n;this.initHighlighting=o;this.initHighlightingOnLoad=l;this.IR="[a-zA-Z][a-zA-Z0-9_]*";this.UIR="[a-zA-Z_][a-zA-Z0-9_]*";this.NR="\\b\\d+(\\.\\d+)?";this.CNR="\\b(0[xX][a-fA-F0-9]+|(\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?)";this.BNR="\\b(0b[01]+)";this.RSR="!|!=|!==|%|%=|&|&&|&=|\\*|\\*=|\\+|\\+=|,|\\.|-|-=|/|/=|:|;|<|<<|<<=|<=|=|==|===|>|>=|>>|>>=|>>>|>>>=|\\?|\\[|\\{|\\(|\\^|\\^=|\\||\\|=|\\|\\||~";this.ER="(?![\\s\\S])";this.BE={b:"\\\\.",r:0};this.ASM={cN:"string",b:"'",e:"'",i:"\\n",c:[this.BE],r:0};this.QSM={cN:"string",b:'"',e:'"',i:"\\n",c:[this.BE],r:0};this.CLCM={cN:"comment",b:"//",e:"$"};this.CBLCLM={cN:"comment",b:"/\\*",e:"\\*/"};this.HCM={cN:"comment",b:"#",e:"$"};this.NM={cN:"number",b:this.NR,r:0};this.CNM={cN:"number",b:this.CNR,r:0};this.BNM={cN:"number",b:this.BNR,r:0};this.inherit=function(r,s){var p={};for(var q in r){p[q]=r[q]}if(s){for(var q in s){p[q]=s[q]}}return p}}();hljs.LANGUAGES.cpp=function(){var a={keyword:{"false":1,"int":1,"float":1,"while":1,"private":1,"char":1,"catch":1,"export":1,virtual:1,operator:2,sizeof:2,dynamic_cast:2,typedef:2,const_cast:2,"const":1,struct:1,"for":1,static_cast:2,union:1,namespace:1,unsigned:1,"long":1,"throw":1,"volatile":2,"static":1,"protected":1,bool:1,template:1,mutable:1,"if":1,"public":1,friend:2,"do":1,"return":1,"goto":1,auto:1,"void":2,"enum":1,"else":1,"break":1,"new":1,extern:1,using:1,"true":1,"class":1,asm:1,"case":1,typeid:1,"short":1,reinterpret_cast:2,"default":1,"double":1,register:1,explicit:1,signed:1,typename:1,"try":1,"this":1,"switch":1,"continue":1,wchar_t:1,inline:1,"delete":1,alignof:1,char16_t:1,char32_t:1,constexpr:1,decltype:1,noexcept:1,nullptr:1,static_assert:1,thread_local:1,restrict:1,_Bool:1,complex:1},built_in:{std:1,string:1,cin:1,cout:1,cerr:1,clog:1,stringstream:1,istringstream:1,ostringstream:1,auto_ptr:1,deque:1,list:1,queue:1,stack:1,vector:1,map:1,set:1,bitset:1,multiset:1,multimap:1,unordered_set:1,unordered_map:1,unordered_multiset:1,unordered_multimap:1,array:1,shared_ptr:1}};return{dM:{k:a,i:"</",c:[hljs.CLCM,hljs.CBLCLM,hljs.QSM,{cN:"string",b:"'\\\\?.",e:"'",i:"."},{cN:"number",b:"\\b(\\d+(\\.\\d*)?|\\.\\d+)(u|U|l|L|ul|UL|f|F)"},hljs.CNM,{cN:"preprocessor",b:"#",e:"$"},{cN:"stl_container",b:"\\b(deque|list|queue|stack|vector|map|set|bitset|multiset|multimap|unordered_map|unordered_set|unordered_multiset|unordered_multimap|array)\\s*<",e:">",k:a,r:10,c:["self"]}]}}}();hljs.LANGUAGES.r={dM:{c:[hljs.HCM,{cN:"number",b:"\\b0[xX][0-9a-fA-F]+[Li]?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+(?:[eE][+\\-]?\\d*)?L\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+\\.(?!\\d)(?:i\\b)?",e:hljs.IMMEDIATE_RE,r:1},{cN:"number",b:"\\b\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\.\\d+(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"keyword",b:"(?:tryCatch|library|setGeneric|setGroupGeneric)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\.",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\d+(?![\\w.])",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\b(?:function)",e:hljs.IMMEDIATE_RE,r:2},{cN:"keyword",b:"(?:if|in|break|next|repeat|else|for|return|switch|while|try|stop|warning|require|attach|detach|source|setMethod|setClass)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"literal",b:"(?:NA|NA_integer_|NA_real_|NA_character_|NA_complex_)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"literal",b:"(?:NULL|TRUE|FALSE|T|F|Inf|NaN)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"identifier",b:"[a-zA-Z.][a-zA-Z0-9._]*\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"<\\-(?!\\s*\\d)",e:hljs.IMMEDIATE_RE,r:2},{cN:"operator",b:"\\->|<\\-",e:hljs.IMMEDIATE_RE,r:1},{cN:"operator",b:"%%|~",e:hljs.IMMEDIATE_RE},{cN:"operator",b:">=|<=|==|!=|\\|\\||&&|=|\\+|\\-|\\*|/|\\^|>|<|!|&|\\||\\$|:",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"%",e:"%",i:"\\n",r:1},{cN:"identifier",b:"`",e:"`",r:0},{cN:"string",b:'"',e:'"',c:[hljs.BE],r:0},{cN:"string",b:"'",e:"'",c:[hljs.BE],r:0},{cN:"paren",b:"[[({\\])}]",e:hljs.IMMEDIATE_RE,r:0}]}};
hljs.initHighlightingOnLoad();
</script>



<style type="text/css">
body, td {
   font-family: sans-serif;
   background-color: white;
   font-size: 13px;
}

body {
  max-width: 800px;
  margin: auto;
  padding: 1em;
  line-height: 20px;
}

tt, code, pre {
   font-family: 'DejaVu Sans Mono', 'Droid Sans Mono', 'Lucida Console', Consolas, Monaco, monospace;
}

h1 {
   font-size:2.2em;
}

h2 {
   font-size:1.8em;
}

h3 {
   font-size:1.4em;
}

h4 {
   font-size:1.0em;
}

h5 {
   font-size:0.9em;
}

h6 {
   font-size:0.8em;
}

a:visited {
   color: rgb(50%, 0%, 50%);
}

pre, img {
  max-width: 100%;
}
pre {
  overflow-x: auto;
}
pre code {
   display: block; padding: 0.5em;
}

code {
  font-size: 92%;
  border: 1px solid #ccc;
}

code[class] {
  background-color: #F8F8F8;
}

table, td, th {
  border: none;
}

blockquote {
   color:#666666;
   margin:0;
   padding-left: 1em;
   border-left: 0.5em #EEE solid;
}

hr {
   height: 0px;
   border-bottom: none;
   border-top-width: thin;
   border-top-style: dotted;
   border-top-color: #999999;
}

@media print {
   * {
      background: transparent !important;
      color: black !important;
      filter:none !important;
      -ms-filter: none !important;
   }

   body {
      font-size:12pt;
      max-width:100%;
   }

   a, a:visited {
      text-decoration: underline;
   }

   hr {
      visibility: hidden;
      page-break-before: always;
   }

   pre, blockquote {
      padding-right: 1em;
      page-break-inside: avoid;
   }

   tr, img {
      page-break-inside: avoid;
   }

   img {
      max-width: 100% !important;
   }

   @page :left {
      margin: 15mm 20mm 15mm 10mm;
   }

   @page :right {
      margin: 15mm 10mm 15mm 20mm;
   }

   p, h2, h3 {
      orphans: 3; widows: 3;
   }

   h2, h3 {
      page-break-after: avoid;
   }
}
</style>



</head>

<body>
<h3>Overview and Synopsis</h3>

<p>This example takes a look at one-way ANOVA.  The goal is to better understand the results of ANOVA and their relationship to results from multivariate regression with dummy variables on the same data.  </p>

<ul>
<li>The R function aov() produces the same results as ANOVA calculations by hand<br/></li>
<li>Multivariate regression with dummy variables produces the same F-value and confidence interval as aov()<br/></li>
<li>Various comparisons of means (Fisher, Tukey, Bonferroni, Holm) produce varying p-value on the differences<br/></li>
<li>R does not always have a great function for creating the CI for these differences in mean, and the packages that do so require downloading compiled code (agricolae, multcomp)<br/></li>
</ul>

<h3>Background</h3>

<p>One-way ANOVA compares variance between groups to variance within groups and draws conclusions about whether the groups are sampled from the same population.  There is a loose requirement that the groups have similar standard deviations (no worse than 2:1 ratio).  If this criteria and several others are met, &ldquo;sampled from the same population&rdquo; becomes a surrogate for &ldquo;have the same mean&rdquo;.  </p>

<h3><em>One-way ANOVA</em></h3>

<p>To run one-way ANOVA, you need at least two groups and sufficient information such that you can determine the MSWithin (Mean Squares Within) and MSBetween (Mean Squares Between).</p>

<h4><em>Determining MSWithin</em></h4>

<p>MSWithin is an estimate of overall variance, treating all groups as if there are from the same population.  The primary components are Sum of Squares Within (SSWithin) and associated degrees of freedom.  </p>

<p>Sum of Squares Within: Within each group, calculate its variance and multiply by (number in group - 1).  If you have been provided standard deviation by group, this is sd<sup>2*(n-1).</sup>  If you have the group members, this is the equivalent of sum-over-group-of (y-member - mean-y-group)<sup>2.</sup>  Sum the SSWithin for each group to get an overall SSWithin.  </p>

<p>dfWithin:  There are (number in group - 1) degrees of freedom for each group.  When all the groups are summed, this comes back to (overall N - overall number of groups), often denoted as dfWithin = (n-g).  </p>

<p>MSWithin:  Not surprisingly, this is SSWithin / dfWithin  </p>

<h4><em>Determining MSBetween</em></h4>

<p>SSBetween is an estimate of overall variance, treating each group as an independent draw from the same population.  The primary components are Sum of Squares Between (SSBetween) and associated degrees of freedom.  </p>

<p>Overall weighted mean aka &ldquo;grand mean&rdquo;: Calculate the overall mean based on all of your group data.  If you have the individual elements, it is mean(n-sub-i).  If you just have individual group means, it is (sum-over-groups-of (n-group) * (mean-group)) / (sum-over-groups-of (n-group)).  </p>

<p>Sum of Squares Between: This is simply the sum over all groups of (n-group) * (groupmean - grandmean)<sup>2.</sup></p>

<p>dfBetween:  There are (number of groups - 1) degrees of freedom, often denoted as dfBetween = (g-1).  </p>

<p>MSBetween:  Not surprisingly, this is SSBetween / dfBetween  </p>

<h4><em>One-way ANOVA Calculation</em></h4>

<p>The one-way ANOVA is based on an F-test of MSBetween against MSWithin.</p>

<p>Test-statistic:  F = MSBetween / MSWithin, df1 = (g-1), df2 = (n-g)</p>

<p>Hypotheses:  The null hypothesis Ho is that F=1 while the alternate hypothesis Ha is that F &gt; 1.  Take a grain of salt on the null hypothesis, but the p-value will come from &ldquo;how extreme is this F&rdquo;.</p>

<p>P-value: The R-calculation is pf(MSBetween/MSWithin, df1=(g-1), df2=(n-g), lower.tail=FALSE).  In theory you set a p-value hurdle before running this calculation.  </p>

<h4><em>Post Hoc Calculation</em></h4>

<p>A significant p-value for ANOVA is a signal of some difference in the group means.  Post-hoc analysis can be run to look at differences in pairs of group means.  Caution is required since with many individual comparisons, many spurious null rejections could occur.  This is the common FWER (family wise error rate) issue.</p>

<p>Some common approaches for mitigating FWER in these paired difference comparisons include:</p>

<p>Bonferroni: Alpha is adjusted to keep the overall likelihood of any spurious null rejection to alpha.  Broadly, this means that if c comparisons will be run, 1 - (1 - newalpha)<sup>c</sup> = overallalpha</p>

<p>Tukey HSD: The Bonferroni approach is very conservative.  Tukey HSD tries to keep the overall FWER near the desired alpha, and will often show significance where Bonferroni does not.</p>

<p>Fisher LSD: For comparison between groups j and k, treat SE = sqrt(MSWithin) * sqrt(1/nj + 1/nk).  In other words, use the overall MSWithin and not any variance that is purely about groups j and k.  For the associated critical t, assume df = (n - g).  CI is then (mean-j minus mean-k) +/- Tc (df=n-g) * SE</p>

<h4><em>Multivariate Regression</em></h4>

<p>ANOVA is a special implementation of multivariate regression with dummy variables.  If there are g groups, the multivariate regression would be based on g-1 dummy variables plus an intercept.  The F statistic from the regression will be the same as from ANOVA.  Mean Regression Sum of Squares is MSBetween and Mean Residual Sum of Squares is MSWithin.  However, the t-statistics (or p-values) for differences in means from regression and post-hoc ANOVA computations can differ.  </p>

<h3>Analysis</h3>

<p>First, we create a simple and small dummy database.  This has 3 groups each with 5 observations.  A boxplot shows significant differences between the groups, as desired so the sample analysis has relevant findings.  </p>

<pre><code class="r">dummyData &lt;- data.frame(groupA=c(12,12,16,17,18), groupB=c(22,24,25,26,28), groupC=c(6,8,9,12,15))
boxplot(dummyData)
</code></pre>

<p><img src="data:image/png;base64,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" alt="plot of chunk unnamed-chunk-1"/></p>

<p>Further, we can calculate a few summary statistics about the dummy data.  </p>

<pre><code class="r">sampleStats &lt;- data.frame(means=rep(0,ncol(dummyData)),stdevs=rep(0,ncol(dummyData)))

for (intCtr in 1:ncol(dummyData)) {
    sampleStats$means[intCtr] &lt;- mean(dummyData[,intCtr])
    sampleStats$stdevs[intCtr] &lt;- sd(dummyData[,intCtr])
}

rownames(sampleStats) &lt;- names(dummyData)

print(&quot;Means and Standard Deviations&quot;)
</code></pre>

<pre><code>## [1] &quot;Means and Standard Deviations&quot;
</code></pre>

<pre><code class="r">sampleStats
</code></pre>

<pre><code>##        means   stdevs
## groupA    15 2.828427
## groupB    25 2.236068
## groupC    10 3.535534
</code></pre>

<pre><code class="r">summary(dummyData)
</code></pre>

<pre><code>##      groupA       groupB       groupC  
##  Min.   :12   Min.   :22   Min.   : 6  
##  1st Qu.:12   1st Qu.:24   1st Qu.: 8  
##  Median :16   Median :25   Median : 9  
##  Mean   :15   Mean   :25   Mean   :10  
##  3rd Qu.:17   3rd Qu.:26   3rd Qu.:12  
##  Max.   :18   Max.   :28   Max.   :15
</code></pre>

<h4><em>One-way ANOVA and Fisher LSD by hand</em></h4>

<p>Next, we run ANOVA by hand on this data.  This is merely to show how it works.  </p>

<pre><code class="r">## Calculate MSWithin
ssWithinGroups &lt;- rep(0,ncol(dummyData))

for (intCtr in 1:ncol(dummyData)) {
    for (intCtr2 in 1:nrow(dummyData)) {
        ssWithinGroups[intCtr] &lt;- ssWithinGroups[intCtr] + 
                                  (dummyData[intCtr2,intCtr] - mean(dummyData[,intCtr]))^2
    }
}

ssWithinGroups
</code></pre>

<pre><code>## [1] 32 20 50
</code></pre>

<pre><code class="r">dfWithin &lt;- ncol(dummyData) * nrow(dummyData) - ncol(dummyData)
msWithin &lt;- sum(ssWithinGroups) / dfWithin
print(paste0(&quot;MS Within: &quot;,msWithin,&quot; with df=&quot;,dfWithin))
</code></pre>

<pre><code>## [1] &quot;MS Within: 8.5 with df=12&quot;
</code></pre>

<pre><code class="r">## Calculate MSBetween
ssBetweenGroups &lt;- rep(0,ncol(dummyData))
grandMean &lt;- mean(as.matrix(dummyData))

for (intCtr in 1:ncol(dummyData)) {
    ssBetweenGroups[intCtr] &lt;- length(dummyData[,intCtr]) * (mean(dummyData[,intCtr]) - grandMean)^2
}

ssBetweenGroups
</code></pre>

<pre><code>## [1]  13.88889 347.22222 222.22222
</code></pre>

<pre><code class="r">dfBetween &lt;- ncol(dummyData) - 1
msBetween &lt;- sum(ssBetweenGroups) / dfBetween
print(paste0(&quot;MS Between: &quot;,round(msBetween,2),&quot; with df=&quot;,dfBetween))
</code></pre>

<pre><code>## [1] &quot;MS Between: 291.67 with df=2&quot;
</code></pre>

<p>Then, calculate the relevant F-statistic, p-value, and Fisher LSD.</p>

<pre><code class="r">myFStat &lt;- msBetween / msWithin
myPValue &lt;- pf(myFStat,df1=msBetween,df2=msWithin,lower.tail=FALSE)

print(paste0(&quot;F-statistic: &quot;,round(myFStat,2),&quot; with df1=&quot;,dfBetween,&quot; and df2=&quot;,dfWithin))
</code></pre>

<pre><code>## [1] &quot;F-statistic: 34.31 with df1=2 and df2=12&quot;
</code></pre>

<pre><code class="r">print(paste0(&quot;Relevant p-value is: &quot;,round(myPValue,4)))
</code></pre>

<pre><code>## [1] &quot;Relevant p-value is: 0&quot;
</code></pre>

<pre><code class="r">nCompare &lt;- 0.5 * (ncol(dummyData) * (ncol(dummyData)-1))

myFisherLSD &lt;- data.frame(compType=rep(&quot;&quot;,nCompare),diffLow=rep(0,nCompare),diffHigh=rep(0,nCompare),
                          stringsAsFactors = FALSE)

## Run for alpha=0.05 two-sided and df=dfWithin
tCritical &lt;- qt(0.025,df=dfWithin,lower.tail=FALSE)

nCompare &lt;- 1 ## Recycling the variable

for (intCtr in 1:(ncol(dummyData)-1)) {
    for (intCtr2 in (intCtr+1):ncol(dummyData)) {
        myFisherLSD$compType[nCompare] &lt;- paste0(names(dummyData)[intCtr],&quot; vs. &quot;,names(dummyData)[intCtr2])

        diffMean &lt;- mean(dummyData[,intCtr]) - mean(dummyData[,intCtr2])
        mySE &lt;- sqrt(msWithin) * sqrt(1/length(dummyData[,intCtr]) + 1/length(dummyData[,intCtr2]))

        myFisherLSD$diffLow[nCompare] &lt;- diffMean - tCritical*mySE
        myFisherLSD$diffHigh[nCompare] &lt;- diffMean + tCritical*mySE

        nCompare &lt;- nCompare + 1
    }
}

print(&quot;Below are the 95% hand-calculated CI for differences in mean using Fisher LSD&quot;)
</code></pre>

<pre><code>## [1] &quot;Below are the 95% hand-calculated CI for differences in mean using Fisher LSD&quot;
</code></pre>

<pre><code class="r">myFisherLSD
</code></pre>

<pre><code>##            compType     diffLow  diffHigh
## 1 groupA vs. groupB -14.0175323 -5.982468
## 2 groupA vs. groupC   0.9824677  9.017532
## 3 groupB vs. groupC  10.9824677 19.017532
</code></pre>

<h4><em>One-way ANOVA and CI by R Function</em></h4>

<p>Next, the data frame is converted to long, skinny form with a factor for the group.</p>

<pre><code class="r">myFactorFrame &lt;- data.frame(keyGroup=rep(&quot;&quot;,nrow(dummyData)*ncol(dummyData)),
                            indValue=rep(0,nrow(dummyData)*ncol(dummyData)),
                            stringsAsFactors = FALSE
                            )

nCompare &lt;- 1 ## Reccylcing the variable

for (intCtr in 1:ncol(dummyData)) {
    for (intCtr2 in 1:nrow(dummyData)) {
        myFactorFrame$keyGroup[nCompare] &lt;- names(dummyData)[intCtr]
        myFactorFrame$indValue[nCompare] &lt;- dummyData[intCtr2,intCtr]
        nCompare &lt;- nCompare + 1
    }
}

myFactorFrame
</code></pre>

<pre><code>##    keyGroup indValue
## 1    groupA       12
## 2    groupA       12
## 3    groupA       16
## 4    groupA       17
## 5    groupA       18
## 6    groupB       22
## 7    groupB       24
## 8    groupB       25
## 9    groupB       26
## 10   groupB       28
## 11   groupC        6
## 12   groupC        8
## 13   groupC        9
## 14   groupC       12
## 15   groupC       15
</code></pre>

<p>The one-way ANOVA is run using the R function aov().  Group C is set as the baseline (intercept).</p>

<pre><code class="r">myFactorFrame$aovFactor &lt;- factor(myFactorFrame$keyGroup,levels=c(&quot;groupC&quot;,&quot;groupA&quot;,&quot;groupB&quot;))
aovFromR &lt;- aov(indValue ~ aovFactor , data=myFactorFrame)
summary(aovFromR)
</code></pre>

<pre><code>##             Df Sum Sq Mean Sq F value   Pr(&gt;F)    
## aovFactor    2  583.3   291.7   34.31 1.09e-05 ***
## Residuals   12  102.0     8.5                     
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
</code></pre>

<pre><code class="r">confint(aovFromR)
</code></pre>

<pre><code>##                      2.5 %    97.5 %
## (Intercept)      7.1591756 12.840824
## aovFactorgroupA  0.9824677  9.017532
## aovFactorgroupB 10.9824677 19.017532
</code></pre>

<p>As expected, MSBetween, MSWithin, dfBetween, dfWithin, F, and p from aov() in R match the hand-calculations.  Further, the confidence intervals for C vs. B and C vs. A are identical (provided care is taken on the direction of the comparison).</p>

<p>Additionally, we can look at the p-values as they would be assessed in any of multiple ways:  </p>

<pre><code class="r">## Run the Tukey HSD
TukeyHSD(aovFromR)
</code></pre>

<pre><code>##   Tukey multiple comparisons of means
##     95% family-wise confidence level
## 
## Fit: aov(formula = indValue ~ aovFactor, data = myFactorFrame)
## 
## $aovFactor
##               diff         lwr       upr     p adj
## groupA-groupC    5  0.08070249  9.919298 0.0462914
## groupB-groupC   15 10.08070249 19.919298 0.0000088
## groupB-groupA   10  5.08070249 14.919298 0.0004187
</code></pre>

<pre><code class="r">## Run standard pairwise t-tests
pairwise.t.test(x=myFactorFrame$indValue , g=myFactorFrame$keyGroup , p.adjust.method = &quot;none&quot;)
</code></pre>

<pre><code>## 
##  Pairwise comparisons using t tests with pooled SD 
## 
## data:  myFactorFrame$indValue and myFactorFrame$keyGroup 
## 
##        groupA  groupB 
## groupB 0.00015 -      
## groupC 0.01890 3.2e-06
## 
## P value adjustment method: none
</code></pre>

<pre><code class="r">## Run Bonferroni pairwise t-tests
pairwise.t.test(x=myFactorFrame$indValue , g=myFactorFrame$keyGroup , p.adjust.method = &quot;bonferroni&quot;)
</code></pre>

<pre><code>## 
##  Pairwise comparisons using t tests with pooled SD 
## 
## data:  myFactorFrame$indValue and myFactorFrame$keyGroup 
## 
##        groupA  groupB 
## groupB 0.00046 -      
## groupC 0.05669 9.5e-06
## 
## P value adjustment method: bonferroni
</code></pre>

<pre><code class="r">## Run Holm pairwise t-tests
pairwise.t.test(x=myFactorFrame$indValue , g=myFactorFrame$keyGroup , p.adjust.method = &quot;holm&quot;)
</code></pre>

<pre><code>## 
##  Pairwise comparisons using t tests with pooled SD 
## 
## data:  myFactorFrame$indValue and myFactorFrame$keyGroup 
## 
##        groupA  groupB 
## groupB 0.00031 -      
## groupC 0.01890 9.5e-06
## 
## P value adjustment method: holm
</code></pre>

<h4><em>Multivariate regression with dummy variables in R</em></h4>

<p>The same results can be generated by creating dummy variables and running linear regression.  For consistency with the above aov(), we will treat groupC as the baseline (intercept).  </p>

<pre><code class="r">myFactorFrame$dummyA &lt;- ifelse(myFactorFrame$keyGroup==&quot;groupA&quot;,1,0)
myFactorFrame$dummyB &lt;- ifelse(myFactorFrame$keyGroup==&quot;groupB&quot;,1,0)

myLMDummy &lt;- lm(indValue ~ dummyA + dummyB, data=myFactorFrame)
summary(myLMDummy)
</code></pre>

<pre><code>## 
## Call:
## lm(formula = indValue ~ dummyA + dummyB, data = myFactorFrame)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
##   -4.0   -2.5    0.0    2.0    5.0 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   10.000      1.304   7.670 5.77e-06 ***
## dummyA         5.000      1.844   2.712   0.0189 *  
## dummyB        15.000      1.844   8.135 3.17e-06 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 2.915 on 12 degrees of freedom
## Multiple R-squared:  0.8512, Adjusted R-squared:  0.8264 
## F-statistic: 34.31 on 2 and 12 DF,  p-value: 1.087e-05
</code></pre>

<pre><code class="r">confint(myLMDummy)
</code></pre>

<pre><code>##                  2.5 %    97.5 %
## (Intercept)  7.1591756 12.840824
## dummyA       0.9824677  9.017532
## dummyB      10.9824677 19.017532
</code></pre>

<p>As expected, the F-statistic is identical in the multivariate dummy regression.  Further, the confidence intervals match those provided by aov().</p>

</body>

</html>
